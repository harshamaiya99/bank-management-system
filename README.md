# Bank Account Management Application

![Python](https://img.shields.io/badge/Python-3.9+-blue?style=flat-square&logo=python)
![FastAPI](https://img.shields.io/badge/FastAPI-0.100.0-009688?style=flat-square&logo=fastapi)
![SQLite](https://img.shields.io/badge/Database-SQLite-003B57?style=flat-square&logo=sqlite)
![Pytest](https://img.shields.io/badge/Tests-Pytest-009688?style=flat-square&logo=pytest)
![Allure Report](https://img.shields.io/badge/Reporting-Allure-FF7700?style=flat-square&logo=allure)
![License](https://img.shields.io/badge/License-MIT-green?style=flat-square)

## Table of Contents

*   [Overview](#overview)
*   [Features](#features)
*   [Technologies Used](#technologies-used)
*   [Project Structure](#project-structure)
*   [Getting Started](#getting-started)
    *   [Prerequisites](#prerequisites)
    *   [Installation](#installation)
    *   [Database Initialization](#database-initialization)
    *   [Running the Application](#running-the-application)
*   [API Endpoints](#api-endpoints)
*   [Frontend Interface](#frontend-interface)
*   [Database Inspection](#database-inspection)
*   [API Testing](#api-testing)
    *   [Running Tests](#running-tests)
    *   [Generating Allure Report](#generating-allure-report)
*   [Contributing](#contributing)
*   [License](#license)
*   [Acknowledgements](#acknowledgements)

---

## Overview

This project implements a simple **Bank Account Management API** using **FastAPI** as the backend framework and **SQLite** for data persistence. It provides a RESTful interface for managing bank accounts, including CRUD (Create, Read, Update, Delete) operations. A basic HTML frontend is also integrated using Jinja2 templates to demonstrate interaction with the API. The API is comprehensively tested using Pytest, with detailed reports generated by Allure.

## Features

*   **RESTful API**: Exposes endpoints for managing bank accounts.
*   **CRUD Operations**: Full support for creating, reading, updating, and deleting account records.
*   **Data Validation**: Utilizes Pydantic models for robust request and response validation.
*   **SQLite Database**: Lightweight and embedded database for easy setup and development.
*   **Modular Design**: Clear separation of concerns between routes, CRUD logic, and database interactions.
*   **CORS Enabled**: Configured to allow cross-origin requests, simplifying frontend integration.
*   **Basic Frontend**: A minimal web interface built with HTML and Jinja2 templates for interactive account management.
*   **Comprehensive API Testing**: Automated tests using Pytest, driven by CSV data.
*   **Allure Reporting**: Generates rich, interactive test reports with history and trend charts.
*   **Health Check Endpoint**: Quickly verify API availability.

## Technologies Used

*   **Backend**:
    *   Python 3.9+
    *   FastAPI
    *   Uvicorn (ASGI server)
    *   SQLite3 (Database)
    *   Pydantic (Data validation and serialization)
    *   Jinja2 (Templating for frontend)
*   **Testing**:
    *   Pytest (Test framework)
    *   Requests (HTTP client for API testing)
    *   Allure-pytest (Test reporting)

## Project Structure

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ crud.py                 # Business logic for database operations
â”‚   â”‚   â”œâ”€â”€ database.py             # SQLite database connection and initialization
â”‚   â”‚   â”œâ”€â”€ main.py                 # FastAPI application entry point
â”‚   â”‚   â”œâ”€â”€ models.py               # Pydantic models for API request/response
â”‚   â”‚   â””â”€â”€ routes.py               # API and HTML route definitions
â”‚   â””â”€â”€ frontend/
â”‚       â”œâ”€â”€ accountDetails.html     # Frontend template for account details
â”‚       â”œâ”€â”€ createAccount.html      # Frontend template for creating an account
â”‚       â””â”€â”€ index.html              # Frontend home page template
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ data/
â”‚       â”‚   â””â”€â”€ accounts.csv        # Test data for API tests
â”‚       â”œâ”€â”€ reports/                # Allure test reports output directory
â”‚       â”‚   â”œâ”€â”€ allure-reports/     # Generated Allure HTML reports
â”‚       â”‚   â””â”€â”€ allure-results/     # Raw Allure test results
â”‚       â”œâ”€â”€ services/
â”‚       â”‚   â”œâ”€â”€ accounts_api.py     # API client for accounts endpoints
â”‚       â”‚   â””â”€â”€ base_api.py         # Base API client with request/response logging
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â”œâ”€â”€ allure_logger.py    # Utility for attaching API details to Allure reports
â”‚       â”‚   â””â”€â”€ csv_reader.py       # Utility to read test data from CSV
â”‚       â””â”€â”€ test_accounts_api.py    # Pytest API tests for account CRUD operations
â”œâ”€â”€ conftest.py                     # Pytest configuration and Allure report generation hook
â”œâ”€â”€ README.md                       # Project documentation (this file)
â””â”€â”€ requirements.txt                # Project dependencies (to be created)
```

## Getting Started

Follow these instructions to set up and run the project locally.

### Prerequisites

Make sure you have the following installed:

*   **Python 3.9+**
*   **Git**

### Installation

1.  **Clone the repository:**

    ```bash
    git clone https://github.com/your-username/web-FastAPI-SQLlite.git
    cd web-FastAPI-SQLlite
    ```

2.  **Create a virtual environment** (recommended):

    ```bash
    python -m venv venv
    ```

3.  **Activate the virtual environment:**

    *   **Windows:**
        ```bash
        .\venv\Scripts\activate
        ```
    *   **macOS/Linux:**
        ```bash
        source venv/bin/activate
        ```

4.  **Install dependencies**:
    *   *Create `requirements.txt` first*:
        ```bash
        # requirements.txt content:
        fastapi==0.100.0
        uvicorn==0.23.2
        pydantic==1.10.12
        Jinja2==3.1.2
        pytest==7.4.0
        requests==2.31.0
        allure-pytest==2.13.6
        ```
    *   Now, install:
        ```bash
        pip install -r requirements.txt
        ```

### Database Initialization

The SQLite database (`database.db`) will be automatically created and initialized with the necessary `accounts` table when the `database.py` module is imported or the application starts. There is no manual step required after initial setup.

### Running the Application

To start the FastAPI server, navigate to the project root and run:

```bash
uvicorn src.backend.main:app --app-dir src/backend --reload --port 9000
```

The API will be accessible at `http://127.0.0.1:9000`.

*   **API Documentation**: `http://127.0.0.1:9000/docs` (Swagger UI) or `http://127.0.0.1:9000/redoc` (ReDoc)
*   **Frontend Home**: `http://127.0.0.1:9000/`

## API Endpoints

The API base URL is `http://127.0.0.1:9000`.

### Health Check

*   **GET `/health`**
    *   Checks if the API is running.
    *   **Response**: `{"status": "healthy"}`

### Account Management

*   **GET `/accounts`**
    *   Retrieves a list of all bank accounts.
    *   **Response**: `List[AccountResponse]`
*   **GET `/accounts/{account_id}`**
    *   Retrieves details for a specific account by `account_id`.
    *   **Path Parameter**: `account_id` (string)
    *   **Response**: `AccountResponse`
*   **POST `/accounts`**
    *   Creates a new bank account.
    *   **Request Body**: `AccountCreate`
    *   **Response**: `{"account_id": "...", "message": "Account created successfully"}`
*   **PUT `/accounts/{account_id}`**
    *   Updates an existing bank account by `account_id`.
    *   **Path Parameter**: `account_id` (string)
    *   **Request Body**: `AccountUpdate`
    *   **Response**: `{"message": "Account updated successfully"}`
*   **DELETE `/accounts/{account_id}`**
    *   Deletes a bank account by `account_id`.
    *   **Path Parameter**: `account_id` (string)
    *   **Response**: `{"message": "Account deleted successfully"}`

_Note: Detailed request/response schemas can be found in the auto-generated API documentation at `/docs`._

## Frontend Interface

A basic web interface is available at the root URL of the application.

*   **Home Page**: `GET /`
    *   Provides navigation and potentially a search for accounts.
*   **Create Account**: `GET /createAccount.html`
    *   A form to create a new bank account.
*   **Account Details**: `GET /accountDetails.html`
    *   Displays details of an account. (Requires integration with `account_id` lookup on the client-side).

## Database Inspection

You have **3 easy ways to check `database.db`**:

### âœ… OPTION 1 (BEST & SIMPLE): Check via Python (Recommended)

From your project root, open a Python interpreter:

```bash
python
```

Then run the following Python code:

```python
import sqlite3
import os

# Adjust path if running from project root, assuming database.db is in src/backend
# If you are in the project root, the path would be "src/backend/database.db"
# If running directly from src/backend, it's "database.db"
# For this example, let's assume running from project root:
db_path = os.path.join("src", "backend", "database.db") 

conn = sqlite3.connect(db_path)
cursor = conn.cursor()

cursor.execute("SELECT * FROM accounts")
rows = cursor.fetchall()

for row in rows:
    print(row)

conn.close()
```

**Expected output (example, actual data may vary):**

```
('8645846', 'John Doe', '1999-08-10', 'Male', 'john.doe@example.com', '+1-555-0199', '123 Main St, New York, NY', '576225', 'Savings', 1000.5, '2023-10-27', 'Active', 'Internet Banking,Debit Card', 1, 1)
('1125085', 'Alice Smith', '1988-03-15', 'Female', 'alice.smith@example.com', '+1-555-0201', '78 Park Lane, Chicago, IL', '60616', 'Current', 25000.75, '2022-06-18', 'Active', 'Internet Banking,Credit Card', 1, 1)
# ... more rows
```

This confirms:
*   Data exists
*   Table structure is correct
*   Backend successfully wrote to the database

### âœ… OPTION 2: Use DB Browser for SQLite (Visual â€“ very clear)

This is best if you prefer a GUI.

**Steps:**

1.  Download [DB Browser for SQLite](https://sqlitebrowser.org/) (it's free).
2.  Open the application.
3.  Click "Open Database".
4.  Navigate to your project folder and select: `web-FastAPI-SQLlite/src/backend/database.db`.
5.  Go to the "Browse Data" tab.
6.  Select the `accounts` table from the dropdown.

You'll see all rows visually ðŸ‘€.

### âœ… OPTION 3: Verify via API (Most realistic)

1.  Ensure your FastAPI server is running (`uvicorn src.backend.main:app --app-dir src/backend --reload --port 9000`).
2.  Open your web browser or an API client (like Postman, Insomnia, or curl) and navigate to:
    ```
    http://127.0.0.1:9000/accounts
    ```

You'll see JSON output similar to this (actual data will reflect what's in your DB):

```json
[
  {
    "account_id": "8645846",
    "account_holder_name": "John Doe",
    "dob": "1999-08-10",
    "gender": "Male",
    "email": "john.doe@example.com",
    "phone": "+1-555-0199",
    "address": "123 Main St, New York, NY",
    "zip_code": "576225",
    "account_type": "Savings",
    "balance": 1000.5,
    "date_opened": "2023-10-27",
    "status": "Active",
    "services": "Internet Banking,Debit Card",
    "marketing_opt_in": true,
    "agreed_to_terms": true
  },
  {
    "account_id": "1125085",
    "account_holder_name": "Alice Smith",
    "dob": "1988-03-15",
    "gender": "Female",
    "email": "alice.smith@example.com",
    "phone": "+1-555-0201",
    "address": "78 Park Lane, Chicago, IL",
    "zip_code": "60616",
    "account_type": "Current",
    "balance": 25000.75,
    "date_opened": "2022-06-18",
    "status": "Active",
    "services": "Internet Banking,Credit Card",
    "marketing_opt_in": true,
    "agreed_to_terms": true
  }
]
```

## API Testing

The project includes a robust API test suite using `pytest` and `allure-pytest` for comprehensive reporting. Tests are data-driven, reading account information from `tests/api/data/accounts.csv`.

### Running Tests

To execute the API tests, ensure your FastAPI application is running (as described in [Running the Application](#running-the-application)) and then run the following command from the project root:

```bash
pytest --alluredir=tests/api/reports/allure-results
```

This will run all tests and generate raw Allure results in the `tests/api/reports/allure-results` directory.

### Generating Allure Report

After running the tests, you can generate an interactive HTML Allure Report. The `conftest.py` file is configured to automatically generate the Allure report, including history, upon `pytest_sessionfinish`.

1.  **Install Allure Commandline Tool**:
    If you haven't already, install the Allure commandline tool.
    *   **macOS (using Homebrew)**:
        ```bash
        brew install allure
        ```
    *   **Windows (using Scoop or Chocolatey)**:
        ```bash
        scoop install allure
        # OR
        choco install allure
        ```
    *   **Linux (using APT)**:
        ```bash
        sudo apt-add-repository ppa:qameta/allure
        sudo apt-get update
        sudo apt-get install allure
        ```
    *   For other OS or manual installation, refer to the [Allure documentation](https://docs.qameta.io/allure/#_installing_a_commandline).

2.  **Generate and Open the Report**:
    Since `conftest.py` handles generation automatically, after running `pytest`, you just need to open the report:

    ```bash
    allure serve tests/api/reports/allure-results
    ```
    This command will generate the report in `tests/api/reports/allure-reports` (if not already generated) and then automatically open it in your default web browser.

The Allure report will provide detailed insights into test execution, including request/response logs, test steps, and overall statistics.

## Contributing

Contributions are welcome! If you have suggestions for improvements, bug fixes, or new features, please open an issue or submit a pull request.

## License

This project is licensed under the MIT License - see the LICENSE file (if exists, otherwise implicitly MIT) for details.

## Acknowledgements

*   [FastAPI](https://fastapi.tiangolo.com/) for being an amazing web framework.
*   [Pytest](https://docs.pytest.org/) for robust testing.
*   [Allure Report](https://docs.qameta.io/allure/) for comprehensive test reporting.
*   [SQLite](https://www.sqlite.org/index.html) for simple and effective data storage.